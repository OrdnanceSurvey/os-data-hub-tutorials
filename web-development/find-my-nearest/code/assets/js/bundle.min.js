var defaults = {
    basemapStyle: "Light",
    copyrightStatement:
      "Contains OS data &copy; Crown copyright and database rights " +
      new Date().getFullYear(),
    fixedPopupMinimumWidth: 768
  },
  isLeaflet = "undefined" != typeof L,
  isMapboxGL = "undefined" != typeof mapboxgl;
"undefined" != typeof proj4 &&
  proj4.defs(
    "EPSG:27700",
    "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs"
  ),
  (window.os = window.os || {}),
  (os.coordinates = {
    centerArray: [],
    centerIndex: 0,
    init: function () {
      $(
        ".osel-control-container .center-control .panel.coords-box .main [class^='navigate-']"
      ).click(function () {
        var e = os.coordinates.centerIndex,
          e =
            2 <
            (e = (e += $(this).hasClass("navigate-next") ? 1 : -1) < 0 ? 2 : e)
              ? 0
              : e;
        $(
          ".osel-control-container .center-control .panel.coords-box .navigation .dot"
        )
          .removeClass("active")
          .eq(e)
          .addClass("active"),
          $(
            ".osel-control-container .center-control .panel.coords-box .main .coord-value"
          ).html(os.coordinates.centerArray[e]),
          (os.coordinates.centerIndex = e);
      });
    },
    update: function () {
      var e = map.getCenter(),
        t = proj4("EPSG:4326", "EPSG:27700", [e.lng, e.lat]),
        o = "Lat/Lon: " + e.lat.toFixed(5) + ", " + e.lng.toFixed(5),
        a = "East/North: " + t[0].toFixed(0) + ", " + t[1].toFixed(0),
        i = "OS Grid Ref: " + os.coordinates.osgbGridRef(t[0], t[1], 5).html;
      (os.coordinates.centerArray.length = 0),
        os.coordinates.centerArray.push(a, o, i),
        $(
          ".osel-control-container .center-control .panel.coords-box .main .coord-value"
        ).html(os.coordinates.centerArray[os.coordinates.centerIndex]);
    },
    osgbGridRef: function (e, t, o) {
      var a = new Array(
          new Array("SV", "SW", "SX", "SY", "SZ", "TV", "TW"),
          new Array("SQ", "SR", "SS", "ST", "SU", "TQ", "TR"),
          new Array("SL", "SM", "SN", "SO", "SP", "TL", "TM"),
          new Array("SF", "SG", "SH", "SJ", "SK", "TF", "TG"),
          new Array("SA", "SB", "SC", "SD", "SE", "TA", "TB"),
          new Array("NV", "NW", "NX", "NY", "NZ", "OV", "OW"),
          new Array("NQ", "NR", "NS", "NT", "NU", "OQ", "OR"),
          new Array("NL", "NM", "NN", "NO", "NP", "OL", "OM"),
          new Array("NF", "NG", "NH", "NJ", "NK", "OF", "OG"),
          new Array("NA", "NB", "NC", "ND", "NE", "OA", "OB"),
          new Array("HV", "HW", "HX", "HY", "HZ", "JV", "JW"),
          new Array("HQ", "HR", "HS", "HT", "HU", "JQ", "JR"),
          new Array("HL", "HM", "HN", "HO", "HP", "JL", "JM")
        ),
        i = Math.floor(e / 1e5),
        s = a[Math.floor(t / 1e5)][i],
        n = Math.round(e % 1e5),
        l = Math.round(t % 1e5),
        n = String(n).padStart(5, "0"),
        l = String(l).padStart(5, "0");
      return {
        text: s + " " + (n = n.substr(0, o)) + " " + (l = l.substr(0, o)),
        html: s + "&thinsp;" + n + "&thinsp;" + l
      };
    }
  }),
  os.coordinates.init(),
  (window.os = window.os || {}),
  (os.main = {
    mapOffsetX: 0,
    sliderProperties: function () {
      var e = $("div.content").length ? 64 : 0,
        t = $(window).width(),
        o = $(window).height() - e;
      return (
        420 <= t && ((t /= 4), (t = Math.max(t, 360)), (t = Math.min(t, 480))),
        { top: e, width: t, height: o }
      );
    },
    viewportPaddingOptions: function () {
      var e = 0,
        t = 0;
      return (
        420 <= $(window).width() &&
          ((e =
            0 === sliderLeft[0].offsetLeft
              ? os.main.sliderProperties().width
              : 0),
          (t =
            $(window).width() - sliderRight[0].offsetLeft == 0
              ? 0
              : os.main.sliderProperties().width)),
        { top: 0, bottom: 0, left: e, right: t }
      );
    },
    hideActionPanels: function () {
      $(".osel-overflow-menu .layer-overflow")
        .removeClass("active")
        .css({ top: -9999, left: -9999 });
    },
    basemapActiveItem: function () {
      var e = $(
        ".osel-control-container .basemap-control .list-select .list-item"
      );
      e.find("div").removeClass("active"),
        e
          .find('[data-style="' + defaults.basemapStyle + '"]')
          .addClass("active");
    }
  }),
  $.fn.extend({
    toggleText: function (e, t) {
      return this.text(this.text() == t ? e : t);
    }
  }),
  $(function () {
    $(window).resize(function () {
      $(".osel-navbar-items .user-profile i").text("keyboard_arrow_down"),
        $(".osel-user-profile-menu, .osel-more-dropmenu").addClass("hidden"),
        $.fn.devbridgeAutocomplete &&
          $(".osel-search-control form input")
            .devbridgeAutocomplete()
            .setOptions({ width: $(".osel-search-control").width() }),
        clearTimeout(window.resizedFinished),
        (window.resizedFinished = setTimeout(function () {
          var e = os.main.sliderProperties().width,
            t = os.main.sliderProperties().height,
            o = 0 == parseInt(sliderLeft.css("left")) ? 0 : -(e - 38),
            a = 0 == parseInt(sliderRight.css("right")) ? 0 : -e;
          sliderLeft
            .height(t)
            .width(e - 38)
            .css({ left: o }),
            sliderRight.height(t).width(e).css({ right: a });
        }, 300));
    }),
      $(document.body).click(function (e) {
        if (
          (0 === $(e.target).closest(".osel-more-dropmenu-btn").length &&
            $(".osel-more-dropmenu").addClass("hidden"),
          0 ===
            $(e.target).closest(".osel-navbar-items .user-profile").length &&
            ($(".osel-navbar-items .user-profile i").text(
              "keyboard_arrow_down"
            ),
            $(".osel-user-profile-menu").addClass("hidden")),
          0 === $(e.target).closest(".osel-dropdown .select").length &&
            ($(".osel-dropdown .select")
              .removeClass("active")
              .children("i")
              .text("keyboard_arrow_down"),
            $(".osel-dropdown .select")
              .parent()
              .children(".options")
              .addClass("hidden")),
          0 < $(e.target).closest(".osel-overflow-menu .layer-overflow").length)
        )
          return !1;
        os.main.hideActionPanels();
      }),
      $(".osel-sliding-side-panel.panel-left [class^='scroller']").scroll(
        function () {
          $(document.body).find(".osel-tooltip").remove(),
            os.main.hideActionPanels();
        }
      ),
      $(".osel-more-dropmenu-btn").click(function () {
        $(".osel-more-dropmenu").toggleClass("hidden");
      }),
      $(".osel-attribution-container").html(defaults.copyrightStatement);
  }),
  (os.main.mapOffsetX = os.main.sliderProperties().width);
var sliderLeft = $(".osel-sliding-side-panel.panel-left").slideReveal({
  width: os.main.sliderProperties().width - 38,
  push: !1,
  trigger: $(
    ".osel-sliding-side-panel.panel-left .panel-toggle .toggle-handle"
  ),
  autoEscape: !1,
  top: os.main.sliderProperties().top,
  show: function (e) {
    e
      .find("div.toggle-handle")
      .html('<i class="material-icons">navigate_before</i>'),
      $(window).width() <= 960 &&
        void 0 !== sliderRight &&
        sliderRight.slideReveal("hide");
  },
  shown: function () {
    (os.main.mapOffsetX = os.main.sliderProperties().width),
      "function" == typeof sliderLeftShownHandler && sliderLeftShownHandler();
  },
  hide: function (e) {
    e.find("div.toggle-handle").html(
      '<i class="material-icons">navigate_next</i>'
    );
  },
  hidden: function () {
    (os.main.mapOffsetX = 38),
      "function" == typeof sliderLeftHiddenHandler && sliderLeftHiddenHandler();
  }
});
sliderLeft.height(os.main.sliderProperties().height).slideReveal("show");
var sliderRight = $(".osel-sliding-side-panel.panel-right").slideReveal({
  width: os.main.sliderProperties().width,
  push: !1,
  trigger: $(".osel-sliding-side-panel.panel-right .panel-close"),
  autoEscape: !1,
  top: os.main.sliderProperties().top,
  position: "right",
  show: function (e) {
    e.addClass("active"),
      $(".osel-fixed-popup").remove(),
      isLeaflet
        ? map.closePopup()
        : isMapboxGL && $(".mapboxgl-popup").remove(),
      $(window).width() <= 960 &&
        void 0 !== sliderLeft &&
        sliderLeft.slideReveal("hide");
  },
  shown: function (e) {
    e.addClass("active"),
      $(".osel-control-container.container-top.container-right").css({
        right: os.main.sliderProperties().width
      });
  },
  hide: function () {
    isMapboxGL && removeHighlight();
  },
  hidden: function (e) {
    e.removeClass("active"),
      $(".osel-control-container.container-top.container-right").css({
        right: 0
      });
  }
});
sliderRight.height(os.main.sliderProperties().height),
  $.fn.sortable &&
    $("ul.layers.sortable").sortable({
      axis: "y",
      cursor: "move",
      helper: "clone",
      start: function () {
        $("body").find(".osel-tooltip").remove(), os.main.hideActionPanels();
      },
      stop: function (e) {
        sortLayers();
      }
    }),
  $(".osel-sliding-side-panel .tabs span").click(function () {
    var e = $(".osel-sliding-side-panel .tabs span.active").data("id"),
      t = $(this).data("id");
    e != t &&
      ($(this).parent().children("span").removeClass("active"),
      $(this).addClass("active"),
      switchLayer(t));
  });
var lyrRadioType = $(
  ".osel-sliding-side-panel.panel-left .layer .layer-element[data-type='radio']"
);
lyrRadioType.click(function () {
  var e = $(this);
  $("ul.layers .layer .layer-element[data-type='radio'][data-state='checked']")
    .parent()
    .data("id") != e.parent().data("id") &&
    (lyrRadioType.attr("data-state", "unchecked"),
    e.attr("data-state", "checked"),
    toggleLayer(e, "radio"));
});
var lyrCheckboxType = $(
  ".osel-sliding-side-panel.panel-left .layer .layer-element[data-type='checkbox']"
);
lyrCheckboxType.click(function () {
  var e,
    t,
    o,
    a,
    i,
    s,
    n = $(this);
  n.hasClass("disabled") ||
    ((i = "checked" == n.attr("data-state") ? "unchecked" : "checked"),
    (t = (e = n.parent()).children('.layer-element[data-type="checkbox"]')),
    e.hasClass("layer")
      ? (e.find('.layer-element[data-type="checkbox"]').attr("data-state", i),
        toggleLayer(n, "checkbox"))
      : (n.attr("data-state", i),
        (o = 0),
        t.each(function () {
          "checked" == $(this).attr("data-state") && o++;
        }),
        (a = e.parent()),
        (i =
          0 == o ? "unchecked" : o == t.length ? "checked" : "indeterminate"),
        a
          .children('.layer-element[data-type="checkbox"]')
          .attr("data-state", i),
        filterLayer(n)),
    $(".osel-overflow-menu").length &&
      ((s = $(
        ".osel-overflow-menu .layer-overflow[data-parent-id='" +
          n.parents(".layer").data("id") +
          "']"
      )),
      "unchecked" == i
        ? (s
            .find(".label, .rangeslider__fill, .rangeslider__handle, output")
            .addClass("disabled"),
          s
            .find('input[type="range"]')
            .prop({ disabled: !0 })
            .rangeslider("update"))
        : (s
            .find(".label, .rangeslider__fill, .rangeslider__handle, output")
            .removeClass("disabled"),
          s
            .find('input[type="range"]')
            .prop({ disabled: !1 })
            .rangeslider("update"))));
}),
  $(".osel-sliding-side-panel .osel-toggle-layers div").click(function () {
    var e = "show-all-layers" == $(this).attr("id") ? "checked" : "unchecked";
    lyrCheckboxType.attr("data-state", e).each(function () {
      $(this).parent().hasClass("layer") && toggleLayer($(this), "checkbox");
    }),
      "clear-all-layers" != $(this).attr("id") &&
        $(".osel-sliding-side-panel .osel-toggle-layers div").toggleClass(
          "hidden"
        );
  }),
  $(
    ".osel-sliding-side-panel.panel-left .layer .layer-element div.toggle i"
  ).click(function (e) {
    os.main.hideActionPanels(),
      e.stopPropagation(),
      $(this).toggleText("keyboard_arrow_up", "keyboard_arrow_down"),
      $(this)
        .parents(".layer")
        .children(".layer-options")
        .toggleClass("hidden");
  }),
  $(
    ".osel-sliding-side-panel.panel-left .layer .layer-element div.overflow i"
  ).click(function (e) {
    e.stopPropagation();
    var t = $(this).parents(".layer"),
      o = t.data("id"),
      a = t.offset().top,
      i = $(".osel-overflow-menu .layer-overflow[data-parent-id='" + o + "']");
    i.hasClass("active")
      ? i.removeClass("active").css({ top: -9999, left: -9999 })
      : (os.main.hideActionPanels(),
        i
          .addClass("active")
          .css({ top: a + 48, left: os.main.sliderProperties().width - 348 }),
        i[0].getBoundingClientRect().bottom <=
          (window.innerHeight || document.documentElement.clientHeight) ||
          i.css({ top: a - (i.height() - 16) }));
  }),
  $(".osel-overflow-menu .layer-overflow .label.interactive").click(
    function () {
      var e;
      "extent" == $(this).data("function")
        ? ((e = $(this).parents(".layer-overflow").data("parent-id")),
          "function" == typeof zoomToLayerExtent && zoomToLayerExtent(e))
        : $(this).data("function"),
        os.main.hideActionPanels();
    }
  ),
  $(
    ".no-touch ul.layers .layer-element div[class*='label-']:not(.expander)"
  ).hover(
    function () {
      var e = $(this);
      e[0].offsetWidth < e[0].scrollWidth &&
        $("<div/>", { class: "osel-tooltip", text: e.text() })
          .css({ top: e.offset().top + "px" })
          .appendTo("body");
    },
    function () {
      $(document.body).find(".osel-tooltip").remove();
    }
  ),
  $(".osel-dropdown .select").click(function () {
    $(this)
      .toggleClass("active")
      .children("i")
      .toggleText("keyboard_arrow_up", "keyboard_arrow_down"),
      $(this).parent().children(".options").toggleClass("hidden");
  }),
  $(".osel-dropdown .options div").click(function () {
    var e = $(this).data("value"),
      t = $(this).children("span").text();
    $(".osel-dropdown .options div")
      .removeClass("selected")
      .children("i")
      .empty(),
      $(this).addClass("selected").children("i").html("done"),
      $(this).parent().toggleClass("hidden");
    var o = $(this).parents().children(".select");
    o.removeClass("active"),
      o.children("span").text(t),
      o.children("i").text("keyboard_arrow_down"),
      filterLayer(e);
  }),
  $(".osel-widget-switch-view .osel-toggle-button").click(function () {
    $(this).parent().children().removeClass("active"),
      $(this).toggleClass("active");
    var e = $(this).attr("id");
    "view-map" == e
      ? ($("#map").removeClass("hidden"), $("#stats").addClass("hidden"))
      : "view-stats" == e &&
        ($("#map").addClass("hidden"), $("#stats").removeClass("hidden")),
      $(".osel-control-container .action-button").removeClass("selected"),
      $(".osel-control-container .panel").css({ bottom: -9999, right: -9999 });
  }),
  $(".osel-control-container .action-button").click(function () {
    $(".osel-control-container")
      .find(".center-control .panel, .basemap-control .panel")
      .css({ bottom: -9999, right: -9999 });
    var e = $(this),
      t = e.offset(),
      o = (t.top, $(window).height() - e.height());
    (o -= t.top),
      e.parent().hasClass("center-control")
        ? ($(
            ".osel-control-container .basemap-control .action-button"
          ).removeClass("selected"),
          $(".osel-map-crosshair").toggleClass("hidden"))
        : e.parent().hasClass("basemap-control") &&
          ($(
            ".osel-control-container .center-control .action-button"
          ).removeClass("selected"),
          $(".osel-map-crosshair").addClass("hidden")),
      e.toggleClass("selected"),
      e.hasClass("selected") &&
        e.parent().children(".panel").css({ bottom: o, right: 94 });
  }),
  $(
    ".no-touch .osel-control-container .basemap-control .list-select .list-item"
  ).hover(
    function () {
      $(this).children("div").addClass("rollover");
    },
    function () {
      $(this).children("div").removeClass("rollover");
    }
  ),
  $(".osel-control-container .basemap-control .list-select .list-item").click(
    function () {
      var e = $(
          ".osel-control-container .basemap-control .list-select .list-item .active"
        ).data("style"),
        t = $(this).children("div").data("style");
      e != t &&
        (switchBasemap(t),
        $(this).siblings(".list-item").children("div").removeClass("active"),
        $(this).children("div").addClass("active").removeClass("rollover"));
    }
  ),
  os.main.basemapActiveItem(),
  $(".osel-control-container .legend-control .widget .panel-expand i").click(
    function () {
      $(this).toggleText("keyboard_arrow_up", "keyboard_arrow_down"),
        $(this)
          .parents(".legend-control")
          .children(".panel")
          .toggleClass("hidden");
    }
  ),
  (window.os = window.os || {}),
  (os.modal = {
    init: function () {
      $(document.body).on("click", ".osel-modal-dialogue-close", function () {
        $(this).parents(".osel-modal-overlay").remove();
      }),
        $(document.body).on(
          "click",
          ".osel-modal-dialogue .osel-button",
          function () {
            $(this).parents(".osel-modal-overlay").remove();
          }
        );
    },
    show: function (e) {
      var t = "";
      if (e.hasOwnProperty("buttons")) {
        t += '<div class="osel-modal-dialogue-buttons">';
        for (var o = 0; o < e.buttons.length; o++)
          t +=
            '<button class="osel-button osel-' +
            e.buttons[o].type +
            '-button">' +
            e.buttons[o].text +
            "</button>";
        t += "</div>";
      }
      var a =
        '            <div class="osel-modal-overlay">                <div class="osel-modal-dialogue">                    <div class="osel-modal-dialogue-body">                        <div class="osel-modal-dialogue-title">' +
        e.title +
        '</div>                        <div class="osel-modal-dialogue-content">' +
        e.content +
        "</div>                    </div>                    " +
        t +
        '                    <div class="osel-modal-dialogue-close"><i class="material-icons" aria-label="Close message">close</i></div>                </div>            </div>        ';
      $(document.body).prepend(a);
    },
    remove: function () {
      $(".osel-modal-dialogue-overlay").remove();
    }
  }),
  os.modal.init(),
  (window.os = window.os || {}),
  (os.notification = {
    init: function () {
      $(document.body).on("click", ".osel-notification-close", function () {
        $(this).parent().remove();
      });
    },
    show: function (e, t, o) {
      o = void 0 === o || o;
      var a = Date.now(),
        i =
          '            <div class="osel-toast-notification ' +
          e +
          '" data-id="' +
          a +
          '">                <div class="osel-notification-icon"></div>                <div class="osel-notification-text">' +
          t +
          '</div>                <div class="osel-notification-close"><i class="material-icons" aria-label="Close message">close</i></div>            </div>        ';
      ($(".content").length ? $(".content") : $(document.body)).append(i),
        o &&
          setTimeout(function () {
            $(".osel-toast-notification[data-id='" + a + "']").fadeOut(
              function () {
                $(this).remove();
              }
            );
          }, 5e3);
    },
    remove: function () {
      $(".osel-toast-notification").remove();
    }
  }),
  os.notification.init(),
  $(function () {
    var e = "[data-rangeslider]",
      t = $(e);
    function a(e) {
      var t = e.value;
      e.parentNode.getElementsByTagName("output")[0].innerHTML = t + "%";
    }
    for (var o = t.length - 1; 0 <= o; o--) a(t[o]);
    $(document).on("input", e, function (e) {
      var t = $(e.target).parents(".layer-overflow").data("parent-id"),
        o = e.target.value / 100;
      setLayerOpacity(t, o), a(e.target);
    }),
      t.rangeslider({ polyfill: !1 });
  }),
  (window.os = window.os || {}),
  (os.palette = {}),
  (os.palette.qualitative = {
    lookup: {
      1: "#FF1F5B",
      2: "#00CD6C",
      3: "#009ADE",
      4: "#AF58BA",
      5: "#FFC61E",
      6: "#F28522",
      7: "#A0B1BA",
      8: "#A6761D",
      9: "#E9002D",
      10: "#FFAA00",
      11: "#00B000"
    },
    groups: {
      "6a": [1, 2, 3, 4, 5, 6],
      "5a": [1, 3, 4, 5, 6],
      "4a": [1, 3, 4, 5],
      "4b": [2, 3, 4, 5],
      "3a": [1, 3, 5],
      "3b": [2, 4, 5],
      "2a": [1, 3],
      "2b": [2, 4],
      rag: [9, 10, 11]
    }
  }),
  (os.palette.sequential = {
    s1: [
      "#E4F1F7",
      "#C5E1EF",
      "#9EC9E2",
      "#6CB0D6",
      "#3C93C2",
      "#226E9C",
      "#0D4A70"
    ],
    s2: [
      "#E1F2E3",
      "#CDE5D2",
      "#9CCEA7",
      "#6CBA7D",
      "#40AD5A",
      "#228B3B",
      "#06592A"
    ],
    s3: [
      "#F9D8E6",
      "#F2ACCA",
      "#ED85B0",
      "#E95694",
      "#E32977",
      "#C40F5B",
      "#8F003B"
    ],
    m1: [
      "#B7E6A5",
      "#7CCBA2",
      "#46AEA0",
      "#089099",
      "#00718B",
      "#045275",
      "#003147"
    ],
    m2: [
      "#FCE1A4",
      "#FABF7B",
      "#F08F6E",
      "#E05C5C",
      "#D12959",
      "#AB1866",
      "#6E005F"
    ],
    m3: [
      "#FFF3B2",
      "#FED976",
      "#FEB24C",
      "#FD8D3C",
      "#FC4E2A",
      "#E31A1C",
      "#B10026"
    ]
  }),
  (os.palette.diverging = {
    d1: [
      "#009392",
      "#39B185",
      "#9CCB86",
      "#E9E29C",
      "#EEB479",
      "#E88471",
      "#CF597E"
    ],
    d2: [
      "#045275",
      "#089099",
      "#7CCBA2",
      "#FCDE9C",
      "#F0746E",
      "#DC3977",
      "#7C1D6F"
    ]
  }),
  (window.os = window.os || {}),
  (os.popup = {
    display: function (e, t, o, a) {
      var i, s, n, l, r, d, c, p, h, u;
      $(window).width() <= defaults.fixedPopupMinimumWidth
        ? ((i =
            '                <div class="osel-fixed-popup">                    <button class="osel-fixed-popup-close-button" type="button" aria-label="Close popup">Ã—</button>                    ' +
            e +
            "                </div>            "),
          $(document.body).append(i))
        : isLeaflet
        ? (s = L.popup({ offset: o }).setLatLng(t).setContent(e).openOn(map))
        : isMapboxGL &&
          ((s = new mapboxgl.Popup({
            closeOnClick: !1,
            anchor: "bottom",
            offset: o
          })
            .setLngLat(t)
            .setHTML(e)
            .addTo(map)),
          (n = $(".mapboxgl-popup").width() / 2),
          (l = $(".mapboxgl-popup").height()),
          (r = $(window).width()),
          (d = $(window).height()),
          (h = (c = Math.round(Number(map.project(t).x))) - r / 2),
          (u = -d / 2 + (p = Math.round(Number(map.project(t).y)))),
          (u += os.main.sliderProperties().top / 2),
          c <= a + n && (h = -(r / 2 - (a + n))),
          r - n - 8 <= c && (h = r / 2 - n - 8),
          p <= l + 16 &&
            (u = -(
              d / 2 -
              (l - s.options.offset[1] + os.main.sliderProperties().top / 2 + 8)
            )),
          map.easeTo({ center: t, offset: [h, u] }),
          s.on("close", function (e) {
            sliderRight.slideReveal("hide"), removeHighlight();
          }));
    }
  }),
  $(document.body).on(
    "click",
    ".osel-popup-content .osel-popup-link",
    function () {
      sliderRight.slideReveal("show");
    }
  ),
  $(document.body).on("click", ".osel-fixed-popup-close-button", function () {
    $(".osel-fixed-popup").remove(), isMapboxGL && removeHighlight();
  }),
  (window.os = window.os || {}),
  (os.search = {
    init: function () {
      null === localStorage.getItem("searchLocationHistory") &&
        localStorage.setItem("searchLocationHistory", ""),
        $(".osel-search-control form").submit(function (e) {
          e.preventDefault(), $(this).find("input").blur();
        }),
        $(".osel-search-control form input")
          .on("change keyup paste", function () {})
          .on("focus", function () {
            $(".osel-search-control, .osel-search-control form").addClass(
              "active"
            );
          })
          .on("blur", function () {
            $(".osel-search-control, .osel-search-control form").removeClass(
              "active"
            );
          })
          .devbridgeAutocomplete({
            serviceUrl: "https://labs.os.uk/api/opennames/v3_1/search",
            dataType: "json",
            params: { maxresults: 10 },
            noCache: !0,
            minChars: 0,
            triggerSelectOnValidInput: !1,
            preventBadQueries: !1,
            autoSelectFirst: !0,
            beforeRender: function (e, t) {
              if (1 == t.length && "" == t[0].value) {
                for (
                  var o = os.search.getSearchLocationHistory(), a = "", i = 0;
                  i < o.length;
                  i++
                )
                  a +=
                    '<div class="autocomplete-suggestion" data-index="' +
                    i +
                    '"><i class="material-icons">' +
                    os.search.getTypeIcon(o[i].data.type) +
                    "</i>" +
                    o[i].value +
                    "</div>";
                e.html(a), Array.prototype.push.apply(t, o), t.shift();
              }
            },
            formatResult: function (e, t) {
              if (!t) return e.value;
              var o =
                "(" +
                t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&") +
                ")";
              return (
                '<i class="material-icons">' +
                os.search.getTypeIcon(e.data.type) +
                "</i>" +
                e.value
                  .replace(new RegExp(o, "gi"), "<strong>$1</strong>")
                  .replace(/&/g, "&amp;")
                  .replace(/</g, "&lt;")
                  .replace(/>/g, "&gt;")
                  .replace(/"/g, "&quot;")
                  .replace(/&lt;(\/?strong)&gt;/g, "<$1>")
              );
            },
            maxHeight: 294,
            width: $(".osel-search-control").width(),
            showNoSuggestionNotice: !0,
            noSuggestionNotice: "No results, please try again",
            transformResult: function (e) {
              return (
                "" === $(this)[0].params.query &&
                  (e.results = [
                    { value: "", type: "", longitude: 0, latitude: 0 }
                  ]),
                {
                  suggestions: $.map(e.results, function (e) {
                    return {
                      value: e.value,
                      data: {
                        id: e.id,
                        type: e.type,
                        lon: e.longitude,
                        lat: e.latitude,
                        bbox: e.bbox
                      }
                    };
                  })
                }
              );
            },
            onSelect: function (e) {
              var t,
                o,
                a,
                i = os.main.viewportPaddingOptions();
              isLeaflet
                ? ((o = {
                    paddingTopLeft: [i.left, i.top],
                    paddingBottomRight: [i.right, i.bottom],
                    maxZoom: Math.min(map.getMaxZoom(), 18)
                  }),
                  (t = [
                    [e.data.lat, e.data.lon],
                    [e.data.lat, e.data.lon]
                  ]),
                  null != e.data.bbox &&
                    (t = [
                      [e.data.bbox[0], e.data.bbox[1]],
                      [e.data.bbox[2], e.data.bbox[3]]
                    ]),
                  map.fitBounds(t, o))
                : isMapboxGL &&
                  ((o = {
                    padding: {
                      top: i.top + 50,
                      bottom: i.bottom + 50,
                      left: i.left + 50,
                      right: i.right + 50
                    },
                    animate: !1,
                    maxZoom: Math.min(map.getMaxZoom(), 16)
                  }),
                  (a = [
                    [e.data.lon, e.data.lat],
                    [e.data.lon, e.data.lat]
                  ]),
                  null != e.data.bbox &&
                    (a = [
                      [e.data.bbox[1], e.data.bbox[0]],
                      [e.data.bbox[3], e.data.bbox[2]]
                    ]),
                  map.fitBounds(a, o)),
                os.search.setSearchLocationHistory(e),
                $(this).blur(),
                $(this).parent().children("a").css({ display: "block" });
            }
          })
          .addClear({
            closeSymbol: '<i class="material-icons">close</i>',
            top: -2,
            right: 0,
            returnFocus: !1
          });
    },
    getTypeIcon: function (e) {
      switch (e) {
        case 7:
        case 8:
          return "directions_car";
        case 9:
          return "directions_railway";
        case 98:
          return "add";
        case 99:
          return "apps";
        default:
          return "place";
      }
    },
    getSearchLocationHistory: function () {
      var e = localStorage.getItem("searchLocationHistory");
      return "" == e ? [] : JSON.parse(e);
    },
    setSearchLocationHistory: function (e) {
      for (
        var t = os.search.getSearchLocationHistory(),
          o = { value: e.value, data: e.data },
          a = 0;
        a < t.length;
        a++
      )
        if (t[a].data.id === e.data.id) {
          t.splice(a, 1);
          break;
        }
      t.unshift(o),
        (t.length = t.length < 3 ? t.length : 3),
        localStorage.setItem("searchLocationHistory", JSON.stringify(t));
    }
  }),
  os.search.init();
